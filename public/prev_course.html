<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course | Amigo's Academy</title>
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    /* Optional: Slightly more structured style for the dynamic parts */
    ul { list-style-type: disc; margin-left: 1.5rem; }
    .course-meta { color: #444; margin-bottom: 1rem; }
    .module { margin-bottom: 1.5rem; }
    .module h3 { color: #004aad; margin-bottom: 0.5rem; }
    .resources ul { list-style-type: none; padding-left: 0; }
    .resources li { margin-bottom: 0.3rem; }
    .resources a { color: #004aad; text-decoration: none; }
    .resources a:hover { text-decoration: underline; }
    .back-link { display: inline-block; margin-top: 2rem; color: #004aad; text-decoration: none; font-weight: bold; }
  </style>
</head>

<body>
  <!-- === HEADER === -->
  <header id="top">
    <div class="container">
      <div class="logo">Amigo's Academy</div>
      <nav>
        <a href="/">Home</a>
        <a href="/#courses">Courses</a>
        <a href="/#team">Team</a>
        <a href="/#contact">Contact</a>
      </nav>
    </div>
  </header>

  <!-- === HERO SECTION === -->
  <section class="hero">
    <div class="container">
      <h1 id="courseTitle">Loading...</h1>
      <p id="courseSubtitle">Please wait while we load your course.</p>
    </div>
  </section>

  <!-- === MAIN CONTENT === -->
  <main class="container" id="courseContent">
    <!-- Content will be dynamically inserted here -->
  </main>

  <!-- === FOOTER === -->
  <footer>
    <div class="container">
      <p>¬© 2025 ‚Äî Amigo's Academy Project <br><br>------ Made by Leonardo Vizca√≠no, Santiago Aguilar and Adri√°n Gallardo ------</p>
      <p><a href="#">Back to the top</a></p>
    </div>
  </footer>

  <script>
    const courseId = window.location.pathname.split("/").pop();

    fetch(`/api/courses/${courseId}`)
      .then(res => {
        if (!res.ok) throw new Error('Course not found');
        return res.json();
      })
      .then(course => {
        // === HERO SECTION ===
        document.getElementById("courseTitle").textContent = course.title;
        document.getElementById("courseSubtitle").textContent = course.subtitle || course.category;

        // === MAIN CONTENT ===
        const main = document.getElementById("courseContent");

        // Build Learning Objectives
        const objectivesHTML = course.objectives?.length
          ? `<ul>${course.objectives.map(obj => `<li>${obj}</li>`).join('')}</ul>`
          : `<p>No specific objectives listed.</p>`;

        // Build Modules
        const modulesHTML = course.content?.length
          ? course.content.map(mod => `
              <div class="module">
                <h3>Module ${mod.module}: ${mod.title}</h3>
                <ul>${mod.topics.map(t => `<li>${t}</li>`).join('')}</ul>
              </div>
            `).join('')
          : `<p>No modules available yet.</p>`;

        // Build Resources
        const resources = course.resources || {};
        const videoLinks = (resources.videoLectures || []).map(v => `<li>üé• <a href="${v}" target="_blank">Video lecture</a></li>`).join('');
        const pdfLinks = (resources.pdfNotes || []).map(p => `<li>üìò <a href="${p}" target="_blank">Download Notes</a></li>`).join('');
        const externalLinks = (resources.externalLinks || []).map(l => `<li>üåê <a href="${l.url}" target="_blank">${l.title}</a></li>`).join('');

        const resourcesHTML = (videoLinks || pdfLinks || externalLinks)
          ? `<ul>${videoLinks + pdfLinks + externalLinks}</ul>`
          : `<p>No resources available yet.</p>`;
        
        // Main HTML Section
        main.innerHTML = `
          <section id="overview">
            <h2>Course Overview</h2>
            <img src="/${course.image}" alt="${course.title}" style="max-width:400px; border-radius:10px; margin-bottom:1rem;">
            <p class="course-meta">
              <strong>Level:</strong> ${course.level || "N/A"} |
              <strong>Duration:</strong> ${course.duration || "N/A"} |
              <strong>Language:</strong> ${course.language || "N/A"}<br>
              <strong>Author:</strong> ${course.author || "Unknown"} |
              <strong>Last Updated:</strong> ${course.lastUpdated || "N/A"}
            </p>
            <p>${course.subtitle}</p>
            <hr>
          </section>

          <section id="objectives">
            <h2>Learning Objectives</h2>
            ${objectivesHTML}
            <hr>
          </section>

          <section id="content">
            <h2>Course Content</h2>
            ${modulesHTML}
            <hr>
          </section>

          <section id="resources" class="resources">
            <h2>Resources</h2>
            ${resourcesHTML}
            <hr>
          </section>

          <a href="/" class="back-link">‚Üê Back to Courses</a>
        `;
      })
      // REMEMBER TO MAKE THE anchor into a button to get back to the courses, its ugly
      .catch(err => {
        document.querySelector(".hero .container").innerHTML = `
          <h1>Course not found</h1>
          <p><a href="/">Return to homepage</a></p>
        `;
        document.getElementById("courseContent").innerHTML = "";
        console.error(err);
      });
  </script>
</body>
</html>
